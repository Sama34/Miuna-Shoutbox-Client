function escapeHtml(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}function revescapeHtml(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return t.replace(/(&amp;|&lt;|&gt;|&quot;|&#039;)/g,function(t){return e[t]})}function regexment(t,e){var a=t.match(/(?:^|\s)@&quot;([^<]+?)&quot;|(?:^|\s)@&#039;([^<]+?)&#039;|(?:^|\s)@`([^<]+?)`|(?:^|\s)@(?:([^"<>\.,;!?()\[\]{}&\'\s\\]{3,}))/gim);if(a){for(var o=new RegExp(e,"gi"),n=0;n<a.length;n++)return e.length==String(a[n]).trim().length-1?(res=o.exec(a[n]),e.toUpperCase()==String(res).toUpperCase()?1:0):0;return 0}return 0}function regexmiuna(t){format_search=[/\[url=(.*?)\](.*?)\[\/url\]/gi,/\[spoiler\](.*?)\[\/spoiler\]/gi,/(^|[^"=\]])(https?:\/\/[a-zA-Z0-9\.\-\_\-\/]+(?:\?[a-zA-Z0-9=\+\_\;\-\&]+)?(?:#[\w]+)?)/gim,/(^|[^"=\]\>\/])(www\.[\S]+(\b|$))/gim,/(^|[^"=\]])(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim],format_replace=['<a href="$1" target="_blank">$2</a>','<tag><div style="margin: 5px"><div style="font-size:11px; border-radius: 3px 3px 0 0 ; padding: 4px; background: #f5f5f5;border:1px solid #ccc;font-weight:bold;color:#000;text-shadow:none; ">'+spo_lan+":&nbsp;&nbsp;<input type=\"button\" onclick=\"if (this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display != '') { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = '';this.innerText = ''; this.value = '"+hide_lan+"'; } else { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = 'none'; this.innerText = ''; this.value = '"+show_lan+'\'; }" style="font-size: 9px;" value="'+show_lan+'"></div><div><div style="border:1px solid #ccc; border-radius: 0 0 3px 3px; border-top: none; padding: 4px;display: none;">$1</div></div></div></tag>','$1<a href="$2" target="_blank">$2</a>','$1<a href="http://$2" target="_blank">$2</a>','<a href="mailto:$1">$1</a>'];for(var e=0;e<format_search.length;e++)t=t.replace(format_search[e],format_replace[e]);for(var a in miuna_smilies)t=t.replace(new RegExp(""+a+"(?!\\S)","gi"),miuna_smilies[a]);return t}function imgconv(t){$("div."+t+", [data-idpos="+t+"]").find("a[href*='.jpg'], a[href*='.gif'], a[href*='.png']").each(function(t){var e=$(this).attr("href");$(this).children("img").length||$(this).empty().append('<img src="'+e+'" style="max-width:80px; max-height:80px" />')})}function imgconvlog(){$("div.msglog").find("a[href*='.jpg'], a[href*='.gif'], a[href*='.png']").each(function(t){var e=$(this).attr("href");$(this).children("img").length||$(this).empty().append('<img src="'+e+'" style="max-width:80px; max-height:80px" />')})}function scrollmiuna(t,e,a,o){($(""+e).scrollTop()+$(""+e).outerHeight()>$(""+e)[0].scrollHeight-90||"old"==a)&&(imgarea=t,"old"==a&&(imgarea=o),$(""+e).animate({scrollTop:$(""+e)[0].scrollHeight},10),$("div."+imgarea+" img, [data-idpos="+t+"] img").one("load",function(){$(""+e).animate({scrollTop:$(""+e)[0].scrollHeight},10)}).each(function(){this.complete&&$(this).load()}))}function scrollmiunalog(){$(".logstyle").animate({scrollTop:$(".logstyle")[0].scrollHeight},10),$("div.msglog img").one("load",function(){$(".logstyle").animate({scrollTop:$(".logstyle")[0].scrollHeight},10)}).each(function(){this.complete&&$(this).load()})}function autocleaner(t,e,a,o){$(""+t).children("div."+e).length>parseInt(a)-1&&(dif=$(""+t).children("div."+e).length-(parseInt(a)-1),"top"==o?$(""+t).children("div."+e).slice(-dif).remove():$(""+t).children("div."+e).slice(0,dif).remove()),setTimeout(function(){$(".shoutarea").children("[data-ment=yes]").length?document.title="("+$(".shoutarea").children("[data-ment=yes]").length+") "+orgtit:document.title=orgtit},200)}function shoutgenerator(t,e,a,o,n,s,i,r,l,d,c,u,m,p,g,h){var b=lanpm=pmspan=area=scrollarea=count=coloruser=usravatar=shoutcolor="";"top"==p?(b="prepend","logback"==t&&(b="append")):(b="append","logback"==t&&(b="prepend")),a==o?(lanpm=pm_fromlan,d=l):(lanpm=pm_tolan,d=d),"shout"==t?(area=scrollarea=".shoutarea",count="msgstcount",autocleaner(area,count,g,p)):"pm"==t?(area=scrollarea="[data-uidpm="+a+"]",count="pmmsgstcount",autocleaner(area,count,g,p)):(area=".loglist",scrollarea=".logstyle",count="msglog"),-1!=$.inArray(parseInt(n),msbvar.miunamodgroups.split(",").map(function(t){return Number(t)}))?coloruser=moduser_color:coloruser=commonuser_color,coloruser.trim()&&(stylecluser='style="color:'+coloruser+'"'),parseInt(actavat)&&(i.trim()?usravatar="<span class='msb_tvatar'><img src="+escapeHtml(i)+" /></span>":usravatar="<span class='msb_tvatar'><img src='"+imagepath+"/default_avatar.png' /></span>"),parseInt(actcolor)&&s&&/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(s)&&(shoutcolor='style="color:'+s+'"'),"shout"!=t&&"lognext"!=t&&"logback"!=t||"pmshout"!=u&&"pmsystem"!=u||(pmspan="<span class='pm_inf'>["+lanpm+" "+escapeHtml(d)+"] </span>"),("shout"==u||"pmshout"==u)&&$(""+area)[b]("<div class='msgShout "+count+" "+escapeHtml(e)+"' data-uid="+parseInt(o)+" data-ided="+escapeHtml(e)+">"+usravatar+"<span class='time_msgShout'><span>[</span>"+r+"<span>]</span></span>"+pmspan+"<span class='username_msgShout' "+stylecluser+">"+escapeHtml(l)+"</span>:<span class='content_msgShout' "+shoutcolor+">"+c+"</span></div>"),("system"==u||"pmsystem"==u)&&$(""+area)[b]("<div class='msgShout "+count+" "+escapeHtml(e)+"' data-uid="+parseInt(o)+" data-ided="+escapeHtml(e)+">"+usravatar+pmspan+"*<span class='username_msgShout' "+stylecluser+">"+escapeHtml(l)+"</span><span class='content_msgShout' "+shoutcolor+">"+c+"</span>*</div>"),0==h&&("lognext"==t||"logback"==t?(parseInt(actaimg)&&imgconvlog(),"top"!=p&&scrollmiunalog()):(parseInt(actaimg)&&imgconv(count),"top"!=p&&scrollmiuna(e,scrollarea,m,count)))}function miunashout(){function t(t){$(".actusr").text(""+usractlan+" "+Object.keys(t.usernames).length)}function e(){"undefined"!=typeof m&&(clearInterval(m),g=0)}function a(t,e,a,o,n,s,i,r,l,d,c,u,m,p,g){var h=moment(m).utcOffset(parseInt(zoneset)).format(zoneformt);e=regexmiuna(escapeHtml(revescapeHtml(e))),nums=numshouts,("lognext"==t||"logback"==t)&&(nums=mpp),shoutgenerator(t,u,o,n,s,i,r,h,a,l,e,c,p,direction,nums,g),1==v[n]&&$("[data-uid="+n+"]").find(".time_msgShout span").css("color",on_color),regexment(e,msbvar.mybbusername)&&($("div."+u).css("border-left",ment_borderstyle).attr("data-ment","yes"),setTimeout(function(){$(".shoutarea").children("[data-ment=yes]").length&&(document.title="("+$(".shoutarea").children("[data-ment=yes]").length+") "+orgtit)},200)),"1"==d&&$("div."+u).css("background-color",edt_color)}function o(t,e,o,n,s,i,r,l,d,c,u,m,p,g,h){var b="shout";if(("lognext"==t||"logback"==t)&&(b=t),"0"==n)a(b,e,o,s,s,i,r,l,n,c,u,m,p,g,h);else if(s==msbvar.mybbuid){if(("msg"==t||"lognext"==t||"logback"==t)&&a(b,e,o,d,s,i,r,l,n,c,u,m,p,g,h),!$("[data-uidpm="+d+"]").length||"lognext"==t||"logback"==t)return;a("pm",e,o,d,s,i,r,l,n,c,u,m,p,g,h)}else{if(d!=msbvar.mybbuid)return;if(("msg"==t||"lognext"==t||"logback"==t)&&a(b,e,o,s,s,i,r,l,n,c,u,m,p,g,h),!$("[data-uidpm="+s+"]").length||"lognext"==t||"logback"==t)return;a("pm",e,o,s,s,i,r,l,n,c,u,m,p,g,h)}}function n(t,e){t=regexmiuna(escapeHtml(revescapeHtml(t))),setTimeout(function(){parseInt(actaimg)&&imgconv(count),$(".shoutarea").children().hasClass(e)&&"top"!=direction&&scrollmiuna(e,".shoutarea","new","msgstcount"),"undefined"!=typeof $("div."+e).parent(".pmarea").attr("data-uidpm")&&(area2="[data-uidpm="+$("div."+e).parent(".pmarea").attr("data-uidpm")+"]","top"!=direction&&scrollmiuna(e,area2,"new",'"pmmsgstcount";'))},50);var a=regexment(t,msbvar.mybbusername);"yes"==$("div."+e).attr("data-ment")&&(a||($("div."+e).css("border-left","").attr("data-ment","no"),setTimeout(function(){$(".shoutarea").children("[data-ment=yes]").length?document.title="("+$(".shoutarea").children("[data-ment=yes]").length+") "+orgtit:document.title=orgtit},200))),a&&($("div."+e).css("border-left",ment_borderstyle).attr("data-ment","yes"),setTimeout(function(){document.title="("+$(".shoutarea").children("[data-ment=yes]").length+") "+orgtit},200)),$("div."+e).children(".content_msgShout").html(t),$("div."+e).css("background-color",edt_color)}function s(){socket.emit("logfpgmsg",{mpp:mpp,uid:msbvar.mybbuid}),socket.once("logfpgmsg",function(t){for(var e=t.length-1;e>=0;e--)o("lognext",t[e].msg,t[e].nick,t[e].nickto,t[e].uid,t[e].gid,t[e].colorsht,t[e].avatar,t[e].uidto,t[e].edt,t[e].type,t[e]._id,t[e].created,"old",e)})}function i(t,e){msbvar.mybbuid!=t&&($("[data-uidpmtab="+t+"]").length?($(".tabShout").removeClass("selected"),$("[data-uidpmtab="+parseInt(t)+"]").addClass("selected"),$(".wrapShout").hide(),$("[data-uidpm="+parseInt(t)+"]").show(),$("#shout_text").attr({"data-type":"pm","data-tbuid":parseInt(t),"data-nicktopm":escapeHtml(e)}),"top"!=direction&&$("[data-uidpm="+parseInt(t)+"]").animate({scrollTop:$("[data-uidpm="+parseInt(t)+"]")[0].scrollHeight},10)):($(".tabShout").removeClass("selected"),$(".wrapShout").hide(),$(".shoutarea").before(' <div class="pmtab tabShout selected" data-uidpmtab="'+parseInt(t)+'"><span class="pmuser" >'+escapeHtml(e)+' </span>[<a href="#" class="closetab">x</a>]</div>').hide(),$(".shoutarea").after('<div class="pmarea wrapShout" data-uidpm="'+parseInt(t)+'" style="height:'+shout_height+'px;"></div>'),$("#shout_text").attr({"data-type":"pm","data-tbuid":parseInt(t),"data-nicktopm":escapeHtml(e)}),socket.emit("getoldpmmsg",{ns:numshouts,suid1:""+parseInt(msbvar.mybbuid)+","+t,suid2:""+t+","+parseInt(msbvar.mybbuid)}),socket.once("load old pm msgs",function(t){for(var e=t.length-1;e>=0;e--)o("pm",t[e].msg,t[e].nick,t[e].nickto,t[e].uid,t[e].gid,t[e].colorsht,t[e].avatar,t[e].uidto,t[e].edt,t[e].type,t[e]._id,t[e].created,"old",e)})))}function r(){heightwin=120,$("body").append('<div class="prune"><div style="overflow-y: auto;max-height: '+heightwin+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+prune_shoutlan+':</strong></div></td></tr><td class="trow1">'+conf_questlan+'</td></table></div><td><button id="prune_yes" style="margin:4px;">'+shout_yeslan+'</button><button id="del_no" style="margin:4px;">'+shout_nolan+"</button></td></div>"),$(".prune").modal({zIndex:7})}function l(t){heightwin=120,$("body").append('<div class="banlist"><div style="overflow-y: auto;max-height: '+heightwin+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+ban_msglan+':</strong></div></td></tr><td class="trow1"><textarea id="ban_list" style="width:97%;height: '+.3*heightwin+'px;" >'+t+'</textarea></td></table></div><td><button id="sv_banlist" style="margin:4px;">'+shout_savelan+"</button></td></div>"),$(".banlist").modal({zIndex:7})}function d(t){heightwin=120,$("body").append('<div class="noticemod"><div style="overflow-y: auto;max-height: '+heightwin+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+not_msglan+':</strong></div></td></tr><td class="trow1"><textarea id="noticetext" style="width:97%;height: '+.3*heightwin+'px;" >'+t+'</textarea></td></table></div><td><button id="sv_notice" style="margin:4px;">'+shout_savelan+"</button></td></div>"),$(".noticemod").modal({zIndex:7})}function c(t,e,a){$("#pmlselector").append('<option value="'+parseInt(e)+'" data-i="'+parseInt(a)+'">'+escapeHtml(t)+"</option>")}function u(t){f=t,heightwin=120,$("body").append('<div class="pmlmod"><div style="overflow-y: auto;max-height: '+heightwin+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+pm_tolan.trim()+':</strong></div></td></tr><td class="trow1"><select id="pmlselector" style="width:100%"></select></td></table></div><td><button id="ok_select" style="margin:4px;">'+pm_lan+"</button></td></div>");for(var e=t.length-1;e>=0;e--)c(t[e].nicks,parseInt(t[e].uid),e);$("#pmlselector").select2(),$(".pmlmod").modal({zIndex:7})}var m,p="1",g=msbvar.floodtime,h="",b="",v="",f="",y=!1;if(parseInt(actcolor)&&(sb_sty=JSON.parse(localStorage.getItem("sb_col_ft")),sb_sty&&/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(sb_sty.color)&&(h=sb_sty.color)),socket.once("login",function(e){y=!0,t(e),b=e.usernames,v=e.uidlist,socket.emit("getoldmsg",{ns:numshouts,uid:msbvar.mybbuid}),socket.emit("updpml",{uid:msbvar.mybbuid,nicks:msbvar.mybbusername})}),socket.on("user joined",function(e){t(e),b=e.usernames,v=e.uidlist,$("[data-uid="+e.uid+"]").length&&$("[data-uid="+e.uid+"]").find(".time_msgShout span").css("color",on_color)}),socket.on("user left",function(e){t(e),b=e.usernames,v=e.uidlist,$("[data-uid="+e.uid+"]").length&&$("[data-uid="+e.uid+"]").find(".time_msgShout span").css("color","")}),socket.emit("add user",{nick:msbvar.mybbusername,uidts:parseInt(msbvar.mybbuid)}),socket.emit("getnot",function(t){}),socket.once("getnot",function(t){t&&$(".notshow").text(escapeHtml(t.not))}),socket.emit("getbanl",function(t){}),socket.once("getbanl",function(t){if(t){var e=t.ban;-1!=$.inArray(parseInt(msbvar.mybbuid),e.split(",").map(function(t){return Number(t)}))&&(p=0)}}),socket.on("updnot",function(t){$(".notshow").text(t?escapeHtml(t.not):"")}),socket.on("updbanl",function(t){if(t){var e=t.ban;p=-1!=$.inArray(parseInt(msbvar.mybbuid),e.split(",").map(function(t){return Number(t)}))?0:1}else p=1}),$("#shout_text").sceditor("instance").bind("keypress",function(t){if(13==t.which){if(!(g>=msbvar.floodtime))return $("#upd_alert").length||$("<div/>",{id:"upd_alert","class":"bottom-right"}).appendTo("body"),setTimeout(function(){diftime=msbvar.floodtime-g,$("#upd_alert").jGrowl(flood_msglan+diftime+secounds_msglan,{life:500})},50),void t.preventDefault();if(!p)return $("#shout_text").sceditor("instance").val("").focus(),$("#upd_alert").length||$("<div/>",{id:"upd_alert","class":"bottom-right"}).appendTo("body"),setTimeout(function(){$("#upd_alert").jGrowl(usr_banlang,{life:500})},200),void t.preventDefault();if(e(),m=setInterval(function(){g+=1},1e3),"shout"==$("#shout_text").attr("data-type")){var a=escapeHtml($("#shout_text").sceditor("instance").val());return parseInt(msbvar.msblc)>0&&(a=a.slice(0,parseInt(msbvar.msblc))),""==a||null==a?($("#shout_text").sceditor("instance").val("").focus(),!1):($("#shout_text").sceditor("instance").val("").focus(),/^\/me[\s]+(.*)$/.test(a)?socket.emit("message",{nick:msbvar.mybbusername,msg:a.slice(4),nickto:"0",uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:0,suid:""+parseInt(msbvar.mybbuid)+",0",type:"system"}):socket.emit("message",{nick:msbvar.mybbusername,msg:a,nickto:"0",uid:parseInt(msbvar.mybbuid),uidto:0,gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,suid:""+parseInt(msbvar.mybbuid)+",0",type:"shout"}),!1)}if("pm"==$("#shout_text").attr("data-type")){var a=escapeHtml($("#shout_text").sceditor("instance").val()),o=parseInt($("#shout_text").attr("data-tbuid")),n=escapeHtml($("#shout_text").attr("data-nicktopm"));return""==a||null==a?($("#shout_text").sceditor("instance").val("").focus(),!1):($("#shout_text").sceditor("instance").val("").focus(),/^\/me[\s]+(.*)$/.test(a)?socket.emit("message",{nick:msbvar.mybbusername,msg:a.slice(4),nickto:n,uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:o,suid:""+parseInt(msbvar.mybbuid)+","+o,type:"pmsystem"}):socket.emit("message",{nick:msbvar.mybbusername,msg:a,nickto:n,uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:o,suid:""+parseInt(msbvar.mybbuid)+","+o,type:"pmshout"}),!1)}if("edit"==$("#shout_text").attr("data-type")){var a=escapeHtml($("#shout_text").sceditor("instance").val());if(parseInt(msbvar.msblc)>0&&(a=a.slice(0,parseInt(msbvar.msblc))),""==a||null==a)return $("#upd_alert").length||$("<div/>",{id:"upd_alert","class":"bottom-right"}).appendTo("body"),setTimeout(function(){$("#upd_alert").jGrowl(mes_emptylan,{life:500})},200),$("#shout_text").sceditor("instance").val("").focus(),!1;$("#shout_text").sceditor("instance").val("").focus(),$(".pmtab.selected").length?(uid=$(this).attr("data-uidpmtab"),nickto=$(this).children(".pmuser").html(),$("#shout_text").attr({"data-type":"pm","data-tbuid":uid,"data-nicktopm":nickto})):$("#shout_text").attr("data-type","shout"),$("#cancel_edit").remove(),$("#del_shout").remove();var s=$("#shout_text").attr("data-id");return socket.emit("updmsg",{id:s,newmsg:a}),!1}}}),socket.once("load old msgs",function(t){for(var e=t.length-1;e>=0;e--)o("msg",t[e].msg,t[e].nick,t[e].nickto,t[e].uid,t[e].gid,t[e].colorsht,t[e].avatar,t[e].uidto,t[e].edt,t[e].type,t[e]._id,t[e].created,"old",e)}),socket.on("message",function(t){o("msg",t.msg,t.nick,t.nickto,t.uid,t.gid,t.colorsht,t.avatar,t.uidto,t.edt,t.type,t._id,t.created,"new",0)}),socket.on("updmsg",function(t){t&&n(t.newmsg,t.id)}),($.fn.on||$.fn.live).call($(document),"click","#log",function(t){function e(t){r=t,pagebase=Math.ceil(r/mpp),npost=r+pagebase,n=Math.ceil(npost/mpp),i=n>1?"1/"+n:"1/1",$("body").append('<div id="logpop" style="width: '+o+'px;max-width:900px !important"><div style="overflow-y: auto;max-height: '+a+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+log_shoutlan+'</strong></div></td></tr><tr><td class="trow1" colspan="2"><div class="logstyle" style="overflow-y: auto;width:99%;height: '+.7*a+'px;word-break:break-all"><div class="loglist"></div></div></td></tr><td class="trow1"><div id="page" style="text-align:center"><button id="page_back" style="margin:4px;">'+log_backlan+'</button> <span id="pagecount" data-pageact="1" data-pagemax="'+n+'">'+i+'</span> <button id="page_next" style="margin:4px;">'+log_nextlan+'</button><button id="htmlgenerator" style="margin:4px;">'+log_htmllan+"</button></div></td></table></div></div>"),$("#logpop").modal({zIndex:7}),s()}var a=.8*window.innerHeight,o=.5*window.innerWidth,n="",i="",r="";(window.innerWidth<650||window.innerWidth<window.innerHeight)&&(o=document.getElementById("edshout_e").offsetWidth),window.innerWidth<window.innerHeight&&(a=.8*o),socket.emit("countmsg",{uid:msbvar.mybbuid}),socket.once("countmsg",function(t){e(t)})}),($.fn.on||$.fn.live).call($(document),"click","#page_next",function(t){t.preventDefault();var e=$("#pagecount").attr("data-pageact"),a=$("#pagecount").attr("data-pagemax");if(parseInt(e)!=parseInt(a)){var n=parseInt(e)+1,s=n+"/"+a,i="";i="top"==direction?$(".msglog:last").attr("data-ided"):$(".msglog:first").attr("data-ided"),$("#pagecount").text(s),$(".loglist").remove(),$(".logstyle").append('<div class="loglist"></div>'),$("#pagecount").attr("data-pageact",n),$("#pagecount").val(s),socket.emit("logmsgnext",{id:i,mpp:mpp,uid:msbvar.mybbuid}),socket.once("logmsgnext",function(t){for(var e=t.length-1;e>=0;e--)o("lognext",t[e].msg,t[e].nick,t[e].nickto,t[e].uid,t[e].gid,t[e].colorsht,t[e].avatar,t[e].uidto,t[e].edt,t[e].type,t[e]._id,t[e].created,"old",e)})}}),($.fn.on||$.fn.live).call($(document),"click","#page_back",function(t){t.preventDefault();var e=$("#pagecount").attr("data-pageact"),a=$("#pagecount").attr("data-pagemax");if(1!=parseInt(e)){var n=parseInt(e)-1,s=n+"/"+a,i="";i="top"==direction?$(".msglog:first").attr("data-ided"):$(".msglog:last").attr("data-ided"),$("#pagecount").text(s),$(".loglist").remove(),$(".logstyle").append('<div class="loglist"></div>'),$("#pagecount").attr("data-pageact",n),$("#pagecount").val(s),socket.emit("logmsgback",{id:i,mpp:mpp,uid:msbvar.mybbuid}),socket.once("logmsgback",function(t){for(var e=t.length-1;e>=0;e--)o("logback",t[e].msg,t[e].nick,t[e].nickto,t[e].uid,t[e].gid,t[e].colorsht,t[e].avatar,t[e].uidto,t[e].edt,t[e].type,t[e]._id,t[e].created,"old",e)})}}),-1!=$.inArray(parseInt(msbvar.mybbusergroup),msbvar.miunamodgroups.split(",").map(function(t){return Number(t)}))){var _=['<a class="sceditor-button" title="'+ban_msglan+'" id="banusr">','<div style="background-image: url('+rootpath+'/images/buddy_delete.png); opacity: 1; cursor: pointer;">'+ban_msglan+"</div>","</a>"];$(_.join("")).appendTo(".sceditor-group:last"),($.fn.on||$.fn.live).call($(document),"click","#banusr",function(t){socket.emit("getbanl",function(t){}),socket.once("getbanl",function(t){var e="";if(t)var e=t.ban;l(e)})});var k=['<a class="sceditor-button" title="'+not_msglan+'" id="notice">','<div style="background-image: url('+rootpath+'/images/icons/information.png); opacity: 1; cursor: pointer;">'+not_msglan+"</div>","</a>"];$(k.join("")).appendTo(".sceditor-group:last"),($.fn.on||$.fn.live).call($(document),"click","#notice",function(t){socket.emit("getnot",function(t){}),socket.once("getnot",function(t){var e="";t&&(e=escapeHtml(t.not)),d(e)})});var x=['<a class="sceditor-button" title="'+prune_msglan+'" id="prune">','<div style="background-image: url('+rootpath+'/images/invalid.png); opacity: 1; cursor: pointer;">'+prune_msglan+"</div>","</a>"];$(x.join("")).appendTo(".sceditor-group:last"),($.fn.on||$.fn.live).call($(document),"click","#prune",function(t){r()}),($.fn.on||$.fn.live).call($(document),"click","#sv_banlist",function(t){t.preventDefault(),socket.emit("message",{nick:msbvar.mybbusername,msg:banlist_modmsglan,nickto:"0",uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:0,suid:""+parseInt(msbvar.mybbuid)+",0",type:"system"});var e=escapeHtml($("#ban_list").val());socket.emit("updbanl",{ban:e}),$.modal.close()}),($.fn.on||$.fn.live).call($(document),"click","#sv_notice",function(t){t.preventDefault(),socket.emit("message",{nick:msbvar.mybbusername,msg:not_modmsglan,nickto:"0",uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:0,suid:""+parseInt(msbvar.mybbuid)+",0",type:"system"});var e=escapeHtml($("#noticetext").val());socket.emit("updnot",{not:e}),$.modal.close()}),($.fn.on||$.fn.live).call($(document),"click","#prune_yes",function(t){t.preventDefault(),socket.emit("purge",function(){}),socket.once("purge",function(){$(".msgShout").remove(),setTimeout(function(){socket.emit("message",{nick:msbvar.mybbusername,msg:shout_prunedmsglan,nickto:"0",uid:parseInt(msbvar.mybbuid),gid:parseInt(msbvar.mybbusergroup),colorsht:h,avatar:msbvar.mybbavatar,uidto:0,suid:""+parseInt(msbvar.mybbuid)+",0",type:"system"})},50)}),$.modal.close()})}($.fn.on||$.fn.live).call($(document),"click","#del_shout",function(t){t.preventDefault();var e=$(this).attr("data-delid"),a=120;$("body").append('<div class="del"><div style="overflow-y: auto;max-height: '+a+'px !important; "><table cellspacing="'+theme_borderwidth+'" cellpadding="'+theme_tablespace+'" class="tborder"><tr><td class="thead" colspan="2"><div><strong>'+del_msglan+':</strong></div></td></tr><td class="trow1">'+conf_questlan+'</td></table></div><td><button id="del_yes" style="margin:4px;" ided="'+e+'">'+shout_yeslan+'</button><button id="del_no" style="margin:4px;">'+shout_nolan+"</button></td></div>"),$(".del").modal({zIndex:7})}),($.fn.on||$.fn.live).call($(document),"click","#del_yes",function(t){t.preventDefault();var e=$(this).attr("ided");socket.emit("rmvmsg",{id:e}),$("#shout_text").sceditor("instance").val("").focus(),$("#shout_text").attr("data-type","shout"),$("#cancel_edit").remove(),$("#del_shout").remove(),$.modal.close()}),socket.on("rmvmsg",function(t){t&&$("div.wrapShout").children("div."+t.id).remove()}),($.fn.on||$.fn.live).call($(document),"click","#del_no",function(t){t.preventDefault(),$("#shout_text").sceditor("instance").val("").focus(),$("#shout_text").attr("data-type","shout"),$("#cancel_edit").remove(),$("#del_shout").remove(),$.modal.close()}),($.fn.on||$.fn.live).call($(document),"click","#ok_select",function(t){t.preventDefault(),null!=$("#pmlselector option:selected").val()&&(uid=$("#pmlselector option:selected").val(),index=$("#pmlselector option:selected").attr("data-i"),nick=f[index].nicks,i(uid,nick)),$.modal.close()});var w=['<a class="sceditor-button" title="'+pm_lan+'" id="pml">','<div style="background-image: url('+rootpath+'/images/new_pm.png); opacity: 1; cursor: pointer;">'+pm_lan+"</div>","</a>"];if($(w.join("")).appendTo(".sceditor-group:last"),($.fn.on||$.fn.live).call($(document),"click","#pml",function(t){socket.emit("getpml",function(t){}),socket.once("getpml",function(t){u(t)})}),parseInt(actcolor)){var I=['<input type="color" value="'+h+'" id="font_color">'];$(I.join("")).appendTo(".sceditor-group:last");var S=document.getElementById("font_color");S.addEventListener("input",function(){var t=JSON.parse(localStorage.getItem("sb_col_ft"));t||(t={}),t.color=S.value,localStorage.setItem("sb_col_ft",JSON.stringify(t)),/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(S.value)&&(h=S.value)},!1)}var H=['<a class="sceditor-button" title="'+log_msglan+'" id="log">','<div style="background-image: url('+rootpath+'/images/log.png); opacity: 1; cursor: pointer;">'+log_msglan+"</div>","</a>"];$(H.join("")).appendTo(".sceditor-group:last"),($.fn.on||$.fn.live).call($(document),"click","#htmlgenerator",function(t){t.preventDefault();var e=document.getElementsByClassName("loglist")[0].innerHTML,a=document.createElement("a"),o="text/html",n=moment().utcOffset(parseInt(zoneset)).format(zoneformt);a.id="loglink",a.setAttribute("download","log("+document.getElementById("pagecount").innerHTML+")("+n+").html"),a.setAttribute("href","data:"+o+";charset=utf-8,"+encodeURIComponent(e)),document.getElementsByClassName("loglist")[0].appendChild(a),$("a#loglink")[0].click()}),($.fn.on||$.fn.live).call($(document),"dblclick",".msgShout",function(t){function e(t,e){t=revescapeHtml(t),e==msbvar.mybbuid||-1!=$.inArray(parseInt(msbvar.mybbusergroup),msbvar.miunamodgroups.split(",").map(function(t){return Number(t)}))?($("#shout_text").attr({"data-type":"edit","data-id":a}),$("#shout_text").sceditor("instance").val(t),$("#cancel_edit").length||$("#miunashoutbox-form").append('<button id="cancel_edit" style="margin:4px;">'+cancel_editlan+'</button><button id="del_shout" style="margin:4px;" data-delid='+a+">"+shout_delan+"</button>")):($("#upd_alert").length||$("<div/>",{id:"upd_alert","class":"bottom-right"}).appendTo("body"),setTimeout(function(){$("#upd_alert").jGrowl(perm_msglan,{life:500})},200))}var a=$(this).attr("data-ided");socket.emit("readonemsg",{id:a}),socket.once("readonemsg",function(t){e(t.msg,parseInt(t.uid))})}),($.fn.on||$.fn.live).call($(document),"click","#cancel_edit",function(t){t.preventDefault(),$("#shout_text").sceditor("instance").val("").focus(),$(".pmtab.selected").length?(uid=$(this).attr("data-uidpmtab"),nickto=$(this).children(".pmuser").html(),$("#shout_text").attr({"data-type":"pm","data-tbuid":uid,"data-nicktopm":nickto})):$("#shout_text").attr("data-type","shout"),$("#cancel_edit").remove(),$("#del_shout").remove()}),($.fn.on||$.fn.live).call($(document),"click",".username_msgShout",function(t){t.preventDefault();var e=$(this).parent().attr("data-uid"),a=$(this).html();i(e,a)}),($.fn.on||$.fn.live).call($(document),"click",".usron",function(t){t.preventDefault();var e=$(this).attr("data-uid"),a=$(this).html();i(e,a)}),($.fn.on||$.fn.live).call($(document),"click",".pm_inf",function(t){t.preventDefault()}),($.fn.on||$.fn.live).call($(document),"click",".closetab",function(t){t.preventDefault();var e=$(this).parent().attr("data-uidpmtab");$(this).parent().remove(),$("[data-uidpm="+e+"]").remove(),$(".tabShout").removeClass("selected"),$(".shouttab").addClass("selected"),$(".wrapShout").hide(),$(".shoutarea").show(),"top"!=direction&&$(".shoutarea").animate({scrollTop:$(".shoutarea")[0].scrollHeight},10),$("#shout_text").attr("data-type","shout")}),($.fn.on||$.fn.live).call($(document),"click",".pmuser",function(t){t.preventDefault();var e=$(this).parent().attr("data-uidpmtab"),a=$(this).html().trim();$(".tabShout").removeClass("selected"),$(this).parent().addClass("selected"),$(".wrapShout").hide(),$("[data-uidpm="+e+"]").show(),"top"!=direction&&$("[data-uidpm="+e+"]").animate({scrollTop:$("[data-uidpm="+e+"]")[0].scrollHeight},10),$("#shout_text").attr({"data-type":"pm","data-tbuid":e,"data-nicktopm":a})}),($.fn.on||$.fn.live).call($(document),"click",".shouttab",function(t){t.preventDefault(),$(".tabShout").removeClass("selected"),$(".shouttab").addClass("selected"),$(".wrapShout").hide(),$(".shoutarea").show(),"top"!=direction&&$(".shoutarea").animate({scrollTop:$(".shoutarea")[0].scrollHeight},10),$("#shout_text").attr("data-type","shout")}),($.fn.on||$.fn.live).call($(document),"click",".actusr",function(t){function e(t,e){$("#onnow").prepend('<span class="usron" data-uid="'+parseInt(e)+'">'+escapeHtml(t)+"</span>, ")}t.preventDefault(),$(".tabShout").removeClass("selected"),$(".actusr").addClass("selected"),$(".numusr").html('<div id="onnow"></div>'),Object.keys(b).map(function(t){e(b[t],t)});var a=$("#onnow").html();a&&$("#onnow").html(a.slice(0,-2)),$(".wrapShout").hide(),$(".numusr").show()})}function upload(t){if(t&&t.type.match(/image.*/)){document.body.className="uploading";var e=document.querySelector(".sceditor-button-imgur div");e.className=e.className+" imgurup";var a=new FormData;a.append("image",t);var o=new XMLHttpRequest;o.open("POST","https://api.imgur.com/3/image.json"),o.onload=function(){var t=JSON.parse(o.responseText).data.link;$("#shout_text").data("sceditor").insert(t);var e=document.querySelector(".sceditor-button-imgur div.imgurup");e.className=e.className-" imgurup",document.querySelector("input.imgur").remove()},o.setRequestHeader("Authorization","Client-ID "+imgurapi),o.send(a)}}$(document).ready(function(t){"use strict";t(document);t('<style type="text/css">.sceditor-dropdown { text-align: '+("rtl"===t("body").css("direction")?"right":"left")+"; }</style>").appendTo("body"),t.sceditor.plugins.bbcode.bbcode.set("spoiler",{format:"[spoiler]{0}[/spoiler]",html:"[spoiler]{0}[/spoiler]"}),t.sceditor.command.set("spoiler",{_dropDown:function(e,a,o){var n;n=t('<div><label for="des">'+e._("Description (optional):")+'</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="'+e._("Insert")+'" /></div>'),n.find(".button").click(function(t){var a=n.find("#des").val(),s="",i="[spoiler]",r="[/spoiler]";a&&(s="="+a,i="[spoiler"+s+"]"),o&&(i=i+o+r,r=null),e.insert(i,r),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(a,"insertspoiler",n)},exec:function(){this.wysiwygEditorInsertHtml("[spoiler]","[/spoiler]")},txtExec:["[spoiler]","[/spoiler]"],tooltip:""+add_spolang}),t.sceditor.command.set("imgur",{exec:function(){document.querySelector("textarea").insertAdjacentHTML("afterEnd",'<input class="imgur" style="visibility:hidden;position:absolute;top:0;" type="file" onchange="upload(this.files[0])" accept="image/*">'),document.querySelector("input.imgur").click()},txtExec:function(){document.querySelector("textarea").insertAdjacentHTML("afterEnd",'<input class="imgur" style="visibility:hidden;position:absolute;top:0;" type="file" onchange="upload(this.files[0])" accept="image/*">'),document.querySelector("input.imgur").click()},tooltip:""+upimgurlang}),t.sceditor.plugins.bbcode.bbcode.set("imgur",{tags:{pre:null},format:function(){document.querySelector("textarea").insertAdjacentHTML("afterEnd",'<input class="imgur" style="visibility:hidden;position:absolute;top:0;" type="file" onchange="upload(this.files[0])" accept="image/*">'),document.querySelector("input.imgur").click()},html:function(){document.querySelector("textarea").insertAdjacentHTML("afterEnd",'<input class="imgur" style="visibility:hidden;position:absolute;top:0;" type="file" onchange="upload(this.files[0])" accept="image/*">'),
document.querySelector("input.imgur").click()}}),t.sceditor.command.remove("table"),t.sceditor.plugins.bbcode.bbcode.remove("table").remove("tr").remove("th").remove("td")});